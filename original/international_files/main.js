var Main=function(b){var a={reportPopup:null,deletePopup:null,editPopup:null,lightboxes:{},updatesTabTimer:-1,curLatestUpdates:null,timerLatestUpdatesRelated:null,LoadAjaxTeaserListerTab:function(g){if(a.curLatestUpdates==null){a.curLatestUpdates=b(".tabs-holder:first")}var c=b("input[id=hidAjaxInput]",a.curLatestUpdates).val()+"&"+g;b("div.tabset ul a",a.curLatestUpdates).removeClass("active");var h=b.query.load("?"+g).get("tab");if(h==null||h==""||h.toString()=="true"){var e=b.query.load("?"+c).get("dta");b("div.tabset ul a:eq("+e+")",a.curLatestUpdates).addClass("active")}else{b("div.tabset ul a:eq("+h+")",a.curLatestUpdates).addClass("active")}if(b(".rssmultimedia").length){var i=b.query.load("?"+c).get("ta").split("|");if(i[h]=="MULTIMEDIAVIDEO"||i[h]=="MULTIMEDIAIMAGE_MULTIMEDIAIMAGEGALLERY"){var d=b(".rssmultimedia a").attr("href").split("?");if(d.length==2){var k;if(i[h]=="MULTIMEDIAVIDEO"){k=b.query.load("?"+d[1]).set("type","videos")}else{k=b.query.load("?"+d[1]).set("type","photos")}b(".rssmultimedia a").attr("href",d[0]+k.toString());b(".rssmultimedia").show()}}}var j=(b("input[name=hidAjaxBasePath]",a.curLatestUpdates.parent()).length)?b("input[name=hidAjaxBasePath]",a.curLatestUpdates.parent()).val():resources.base_url;var f=(b("input[name=hidAjaxUICulture]",a.curLatestUpdates.parent()).length)?b("input[name=hidAjaxUICulture]",a.curLatestUpdates.parent()).val():resources.uiculture;b.ajax({type:"POST",url:j+"/Templates/Planet3/Handlers/GetControl.ashx",data:"loadControl=~/Templates/Planet3/UserControls/Teasers/TeaserLister.ascx&queryString="+encodeURIComponent(c)+"&uiculture="+f,success:function(l){if(a.updatesTabTimer!=-1){clearTimeout(a.updatesTabTimer);a.updatesTabTimer=-1}if(l=="error"){b(".reload",a.curLatestUpdates).html('<div style="color:red">An error occurred please try again later.</div>')}else{b(".reload",a.curLatestUpdates).html(b("#reload",l).html());if(b("#hidConnectToRelatedItems").val()=="True"){if(a.timerLatestUpdatesRelated!=null){clearTimeout(a.timerLatestUpdatesRelated)}a.timerLatestUpdatesRelated=setTimeout("Main.UpdateLatestUpdatesRelated()",500)}a.SetAjaxLinksPaging();a.SetAjaxTopicFilter();b("div.tabset ul a",a.curLatestUpdates).unbind("click");b("div.tabset ul a",a.curLatestUpdates).click(function(){a.curLatestUpdates=b(this).parents(".tabs-holder");lup=b(".tabs-holder").index(b(this).parents(".tabs-holder"));q=b.query.load(b(this).attr("href"));if(lup>0){q=q.set("lup",lup)}newhref=q.toString().replace("?","#");b(this).attr("href",newhref);var m=this.href;m=m.replace(/^.*#/,"");b.historyLoad(m);return false});b(".addthis_button",a.curLatestUpdates).each(function(){itemLink=b("h3 a",b(this).closest(".news"))[0].href;itemText=b("h3 a",b(this).closest(".news")).eq(0).text();b(this).attr("onmouseover","return addthis_open(this, '', '"+itemLink+"', '"+itemText+"');");b(this).attr("onmouseout","return addthis_close(this);")});if(b(".addthis_cn_button",a.curLatestUpdates).length>0){$$addthis.rebind()}if(b("a[name='xn_share']").length>0){XN.Share.init()}}}});if(a.updatesTabTimer==-1){a.updatesTabTimer=setTimeout("Main.ShowAjaxLoader();",300)}if(b(".reload",a.curLatestUpdates).data("scrollIntoView")){b(".reload",a.curLatestUpdates).parent()[0].scrollIntoView();b(".reload",a.curLatestUpdates).data("scrollIntoView",false)}},SetAjaxLinks:function(){if(b("#hidAjaxInput").length&&b("#hidAjaxInput").val()!=""){var c=0;b("div.tabset ul a,.top-holder a.show").each(function(d){c=b(".tabs-holder").index(b(this).parents(".tabs-holder"));q=b.query.load(b(this).attr("href"));if(c>0){q=q.set("lup",c)}newhref=q.toString().replace("?","#");b(this).attr("href",newhref);b(this).click(function(){a.curLatestUpdates=b(this).parents(".tabs-holder");var e=this.href;e=e.replace(/^.*#/,"");b.historyLoad(e);return false})});a.SetAjaxLinksPaging();a.SetAjaxTopicFilter()}},SetAjaxTopicFilter:function(){b("#tab1 .sort select, #tab1 .top-holder select").bind("change",function(){var f="st="+b(this).val();a.curLatestUpdates=b(this).parents(".tabs-holder");var g="";if(location.href.indexOf("#")!=-1){var e=b.query.load("?"+location.href.split("#")[1]);lup=b(".tabs-holder").index(b(this).parents(".tabs-holder"));if(lup>0){g+="&lup="+lup}var d=e.get("tab").toString();var c=e.get("gvs").toString();if(d!=""&&d!="true"){g+="&tab="+e.get("tab")}if(c!=""){g+="&gvs="+e.get("gvs")}}b.historyLoad(f+g)})},SetAjaxLinksPaging:function(){b("div.paginator a",a.curLatestUpdates).each(function(c){if(!b(this).hasClass("deactive")){lup=b(".tabs-holder").index(b(this).parents(".tabs-holder"));q=b.query.load(b(this).attr("href"));if(lup>0){q=q.set("lup",lup)}newhref=q.toString().replace("?","#");if(q.get("page")!=""){b(this).attr("href",newhref)}}}).click(function(){a.curLatestUpdates=b(this).parents(".tabs-holder");b(".reload",a.curLatestUpdates).data("scrollIntoView",true)})},ShowOptions:function(j,c){if(b("#optionsDiv"+c).length==0){var e=b('<div id="optionsDiv'+c+'" class="outtaHere optionsDivInvisible"></div>');var g=b("<ul></ul>");b("select option",j.parent()).each(function(l){var m=b('<li><a href="'+b(this).val()+'">'+b(this).text()+"</a></li>");g.append(m)});e.append(g);var d=215;var f=j.width()-1;var k=b("select",j.parent()).attr("class");if(k.indexOf("width;")!=-1){d=parseInt(k.split(";")[1])}if(f>d){d=f}else{j.width(d+"px")}var h=j.offset();e.css({top:(h.top+j.outerHeight(true))+"px",width:d+"px","overflow-y":"auto","max-height":"450px",direction:"ltr",right:"auto",left:h.left+"px"});b("body").append(e)}else{var d=215;var f=j.width()-1;var k=b("select",j.parent()).attr("class");if(k.indexOf("width;")!=-1){d=parseInt(k.split(";")[1])}if(f<d){j.width(d+"px")}}var i=j.offset();b("#optionsDiv"+c).css({right:"auto",left:i.left+"px"});b("#optionsDiv"+c).removeClass("optionsDivInvisible");b("#optionsDiv"+c).addClass("optionsDivVisible");b("#optionsDiv"+c).show()},HideOptions:function(c){b("#optionsDiv"+c).addClass("optionsDivInvisible");b("#optionsDiv"+c).removeClass("optionsDivVisible");b("#optionsDiv"+c).hide()},HideAllOptions:function(){b("div.selectArea").removeClass("active-select").css("width","auto");b("div.optionsDivVisible").each(function(c){b(this).addClass("optionsDivInvisible");b(this).removeClass("optionsDivVisible");b(this).hide()})}};return{UpdateLatestUpdatesRelated:function(){var f=(b("input[name=hidAjaxBasePath]",a.curLatestUpdates.parent()).length)?b("input[name=hidAjaxBasePath]",a.curLatestUpdates.parent()).val():resources.base_url;var d=(b("input[name=hidAjaxUICulture]",a.curLatestUpdates.parent()).length)?b("input[name=hidAjaxUICulture]",a.curLatestUpdates.parent()).val():resources.uiculture;var c=b.query.load(b(".tabset a.active",a.curLatestUpdates).attr("href").replace("#","?")).get("tab");var e=b.query.load("?"+b("#hidAjaxInput",a.curLatestUpdates).val()).get("ta").toString().split("|")[c];b(".csn").each(function(g){var h=b(this);var j=b(".hidAjaxInput",h).val()+"&ta="+e;b.ajax({type:"POST",url:f+"/Templates/Planet3/Handlers/GetControl.ashx",data:"loadControl=~/Templates/Planet3/UserControls/DynamicContent/CrossSectionNavigation.ascx&queryString="+encodeURIComponent(j)+"&uiculture="+d,success:function(i){if(i!="error"){h.html(b(i).html());h.effect("highlight",{color:"#DFFEBE"},1000)}}})})},pinFooterToBottomPage:function(){try{if(b("div.pin-footer-to-bottom-page").length){b("div.page:first").height("auto");var g=Number(b(window).height());var f=b("body").height();if(g>f){var d=b("div.pin-footer-to-bottom-page").height();var c=g-d;b("div.page:first").height(c)}}}catch(e){}},openLightbox:function(e,c,d){if(!a.lightboxes[e]){if(typeof(c)=="undefined"||!c){c={container:document.getElementById(e)}}a.lightboxes[e]=new Lightbox(c,d)}a.lightboxes[e].Show()},ShowReportCommentPopup:function(c){b("#currentCommentId").val(c);if(a.reportPopup==null){a.reportPopup=new Lightbox({container:document.getElementById("pReport"),width:"505px"})}a.reportPopup.Show()},ShowRemoveCommentPopup:function(c){b("#currentCommentId").val(c);b(".comment-box img").attr("src",b("#comment_"+c+" img").attr("src"));b(".comment-box strong").html(b("#comment_"+c+" .block .say p strong").html());b(".comment-box blockquote q").html(b("#comment_"+c+" .block p#comment-content").html());if(a.deletePopup==null){a.deletePopup=new Lightbox({container:document.getElementById("pDelete"),width:"505px"})}a.deletePopup.Show()},ShowAjaxLoader:function(){b(".reload div.tab",a.curLatestUpdates).hide();b(".reload div.ajaxloader",a.curLatestUpdates).show()},DoSimpleSearch:function(c){if(c==resources.header_search_searchboxvalue){c=""}window.location=resources.search_url+"?all="+encodeURIComponent(c.stripTags());return false},TrackNewsletter:function(){_gaq.push(["_trackPageview",resources.gacurl])},getParameterByName:function(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+d+"=([^&#]*)";var f=new RegExp(c);var e=f.exec(window.location.href);if(e==null){return""}else{return decodeURIComponent(e[1].replace(/\+/g," "))}},OnReady:function(){String.prototype.stripTags=function(){return this.replace(/<(.|\n)*?>/g,"")};String.prototype.endsWith=function(d){return(this.match(d+"$")==d)};b(".javascript-enabled input").val("1");b("#SearchBox input[type=text],#QuickSearch input[type=text],input.jssearchbox").bind("focus",function(){if(b(this).val()==resources.header_search_searchboxvalue){b(this).val("")}}).bind("blur",function(){if(b(this).val()==""){b(this).val(resources.header_search_searchboxvalue)}}).bind("keydown",function(d){if(d.keyCode==13){return Main.DoSimpleSearch(b(this).val())}});b("#SearchBox input[type=submit]").bind("click",function(){return Main.DoSimpleSearch(b("input[type=text]",b(this).parent()).val())});b("body").bind("click",function(){a.HideAllOptions()});b("#header div.selectArea").bind("click",function(){if(b(this).hasClass("active-select")){a.HideAllOptions();b(this).removeClass("active-select");a.HideOptions(this.id)}else{a.HideAllOptions();b(this).addClass("active-select");a.ShowOptions(b(this),this.id)}return false});b("div.events-box a.EnlargeImage").bind("click",function(){var f=encodeURIComponent(b(this).attr("href"));var h=b(this).parent().parent();var e=b(".events-content .date",h).html();var i=b(".events-content strong",h).html();var g=b(".events-content p",h).html();var d={contentUrl:resources.base_url+"Templates/Planet3/Pages/Popups/ThumbnailEnlarged.aspx .enlargepopup",contentParams:{imageUrl:f,uiculture:resources.uiculture}};Main.openLightbox(f,d,function(){var j=b(".lightbox:visible");b(".info h2",j).html(i);b(".info p.desc",j).html(g)});return false});b("a.BlogEnlargeImage").bind("click",function(){var e=encodeURIComponent(b(this).attr("href"));if(e.endsWith(".jpg")){var f=b(this).parent().parent();var d={contentUrl:resources.base_url+"Templates/Planet3/Pages/Popups/ThumbnailEnlarged.aspx .enlargepopup",contentParams:{imageUrl:e,uiculture:resources.uiculture}};Main.openLightbox(e,d,function(){var g=b(".lightbox:visible")})}else{window.open(b(this).attr("href"),"mywindow")}return false});if(b("div.tabset ul a").length){try{b.historyInit(a.LoadAjaxTeaserListerTab,"jquery_history.html")}catch(c){}a.SetAjaxLinks()}b("div.donate-frm ul a").each(function(){b(this).click(function(){var d=b(this).closest("div.donate-frm");d.find("fieldset > div.tab").hide();d.find("input.donation-amount-input").val("");d.find(".donation-radio").attr("checked","");d.find(".donation-radio-other").attr("checked","");var e=b(this).attr("rel");d.find(e).show();d.find("li.active").removeClass("active");b(this).parent().addClass("active")})});b("input.donation-amount-input").each(function(){b(this).focus(function(){b(this).closest(".row").children(".donation-radio-other").attr("checked","checked")})});b("input.donation-radio").each(function(){b(this).click(function(){b(this).closest(".tab").find("input.donation-amount-input").val("")})});b(".form-button, .form-button-ready").hover(function(){var d=b(this).attr("class");if(d.indexOf("form-button-ready")!=-1){b(this).removeClass("form-button-ready").addClass("form-button-ready-hover")}else{b(this).removeClass("form-button").addClass("form-button-hover")}},function(){var d=b(this).attr("class");if(d.indexOf("form-button-ready")!=-1){b(this).removeClass("form-button-ready-hover").addClass("form-button-ready")}else{b(this).removeClass("form-button-hover").addClass("form-button")}});b(".search-button, .search-button-ready").hover(function(){var d=b(this).attr("class");if(d.indexOf("search-button-ready")!=-1){b(this).attr("class",d.replace("search-button-ready","search-button-ready-hover"))}else{b(this).attr("class",d.replace("search-button","search-button-hover"))}},function(){var d=b(this).attr("class");if(d.indexOf("search-button-ready")!=-1){b(this).attr("class",d.replace("search-button-ready-hover","search-button-ready"))}else{b(this).attr("class",d.replace("search-button-hover","search-button"))}});Main.pinFooterToBottomPage();if(b("#sendfriend input[type=hidden]").length&&b("#sendfriend input[type=hidden]").val()=="1"){window.location.hash="#sendfriend"}if(typeof(Action)!="undefined"&&Action){Action.OnReady()}if(typeof(Donation)!="undefined"&&Donation){Donation.OnReady()}if(typeof(DonationCanada)!="undefined"&&DonationCanada){DonationCanada.OnReady()}if(typeof(DetailPage)!="undefined"&&DetailPage){DetailPage.OnReady()}if(typeof(Faq)!="undefined"&&Faq){Faq.OnReady()}if(typeof(MultimediaDetail)!="undefined"&&MultimediaDetail){MultimediaDetail.OnReady()}if(typeof(Blog)!="undefined"&&Blog){Blog.OnReady()}if(typeof(Account)!="undefined"&&Account){Account.OnReady()}if(typeof(SearchPage)!="undefined"&&SearchPage){SearchPage.OnReady()}if(typeof(Validator)!="undefined"&&Validator){Validator.OnReady()}if(typeof(ErrorPage)!="undefined"&&ErrorPage){ErrorPage.OnReady()}b(".light-box.onload").each(function(){new Lightbox({container:this}).Show()});b("object").each(function(d){if(b("param[name=wmode]",this).length==0&&b("embed",this).length==1){try{b(this).prepend('<param value="transparent" name="wmode"/>');b("embed",this).attr("wmode","transparent")}catch(e){}}});b(".drop-holder").bind("mouseenter",function(){b(this).prev().addClass("active")}).bind("mouseleave",function(){b(this).prev().removeClass("active")});b(".petition_box a.activate",".onpage-widget").click(function(){b(".petition_box",b(this).closest(".widget-main")).removeClass("active");b(this).parent().parent().css("display","none");b(this).parent().parent().addClass("active");b(this).parent().parent().slideDown("slow");return false});b("a",".action-widget-embed").click(function(){b("div",b(this).parent()).slideToggle("slow");if(b(this).hasClass("expanded")){b(this).removeClass("expanded")}else{b(this).addClass("expanded")}return false});b("select[name=district] option[value*=;]",".action-widget").hide();b("select[name=province]",".action-widget").change(function(){var e=b(this).val();var f=b("select[name=district]",b(this).parents(".action-widget"));if(e==-1){b("option",f).show()}else{b("option[value*=;]",f).hide();b("option[value$=;"+e+"]",f).show();b("option:visible:first",f).attr("selected",true)}});if((typeof(newsletterSignupSuccesful)!="undefined"&&newsletterSignupSuccesful==true)||(Main.getParameterByName("newsletterSignupSuccesful")=="true")){Main.TrackNewsletter()}}}}(jQuery);$(document).ready(function(d){Main.OnReady();var b=d.query.GET("showtimer");if(b!=""&&globalTimer!=null){var c=globalTimer.ShowIntermediate();var a="DOM Ready in "+c+" ms.";d("#loadTime").html(a)}});$(window).load(function(){var a=$.query.GET("showtimer");if(a!=""&&globalTimer!=null){var b=globalTimer.Stop();var c=" Load in "+b+" ms.";$("#loadTime").append(c)}});$(window).resize(Main.pinFooterToBottomPage);